) %>%
addPolygons(
data = smc_pdas_blocks,
color = "red",
weight = 0.75,
fill = F
)
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
data = smc_pdas,
stroke = F,
fillOpacity = 0.5
) %>%
addPolygons(
data = smc_pdas_blocks,
color = "red",
weight = 0.75,
fill = F
)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = F, message = F)
library(tidyverse)
library(plotly)
library(sf)
library(tigris)
library(leaflet)
library(censusapi)
Sys.setenv(CENSUS_KEY="0f0e2bffc9d96d5405bcb932e25318a4edb32602")
smc_pop_2020 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:081",
vars = "P1_001N"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P1_001N
)
dec_vars_2020 <-
listCensusMetadata(
name = "2020/dec/pl",
type = "variables"
)
smc_pop_race_2020 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:081",
vars = "group(P1)"
) %>%
mutate(
block =
paste0(state,county,tract,block)
) %>%
select(!c(GEO_ID,state,county,tract,NAME) & !ends_with(c("NA"))) %>%
pivot_longer(
ends_with("N"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
dec_vars_2020 %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,"category1","category2"),
sep = "!!"
)
smc_pop_race_2020 <- smc_pop_race_2020 %>%
mutate(
race = case_when(
category1 == "Population of two or more races:" & is.na(category2) ~ "Two or more races",
category1 == "Population of two or more races:" ~ "",
!is.na(category2) ~ category2,
TRUE ~ ""
)
)
smc_pop_race_2020 <- smc_pop_race_2020 %>%
filter(race != "") %>%
select(block, race, pop = estimate)
View(smc_pop_race_2020)
smc_blocks_2020 <- blocks("CA", "San Mateo", year = 2020, progress_bar = F)
smc_blocks_2020 <- blocks("CA", "San Mateo", year = 2020, progress_bar = F)
View(smc_blocks_2020)
Sys.setenv(CENSUS_KEY="0f0e2bffc9d96d5405bcb932e25318a4edb32602")
smc_pop_2010 <-
getCensus(
name = "dec/pl",
vintage = 2010,
region = "block:*",
regionin = "state:06+county:081",
vars = "P001001"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P001001
)
dec_vars_2010 <-
listCensusMetadata(
name = "2010/dec/pl",
type = "variables"
)
smc_pop_race_2010 <-
getCensus(
name = "dec/pl",
vintage = 2010,
region = "block:*",
regionin = "state:06+county:081",
vars = "group(P1)"
) %>%
mutate(
block =
paste0(state,county,tract,block)
) %>%
select(!c(GEO_ID,state,county,tract,NAME)) %>%
pivot_longer(
starts_with("P"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
dec_vars_2010 %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,"category1","category2"),
sep = "!!"
)
smc_pop_race_2010 <- smc_pop_race_2010 %>%
mutate(
race = case_when(
category1 == "Population of two or more races:" & is.na(category2) ~ "Two or more races",
category1 == "Population of two or more races:" ~ "",
!is.na(category2) ~ category2,
TRUE ~ ""
)
)
smc_pop_race_2010 <- smc_pop_race_2010 %>%
filter(race != "") %>%
select(block, race, pop = estimate)
View(smc_pop_race_2010)
View(smc_pop_race_2020)
sum(smc_pop_race_2010$pop)
sum(smc_pop_race_2020)
sum(smc_pop_race_2020$pop)
smc_pop_race_2010 <-
getCensus(
name = "dec/pl",
vintage = 2010,
region = "block:*",
regionin = "state:06+county:081",
vars = "group(P1)"
) %>%
mutate(
block =
paste0(state,county,tract,block)
) %>%
select(!c(GEO_ID,state,county,tract,NAME)) %>%
pivot_longer(
starts_with("P"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
dec_vars_2010 %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,"category1","category2"),
sep = "!!"
)
smc_pop_race_2010 <-
getCensus(
name = "dec/pl",
vintage = 2010,
region = "block:*",
regionin = "state:06+county:081",
vars = "group(P1)"
)
smc_pop_race_2010 <-
getCensus(
name = "dec/pl",
vintage = 2010,
region = "block:*",
regionin = "state:06+county:081",
vars = "group(P1)"
) %>%
mutate(
block =
paste0(state,county,tract,block)
) %>%
select(!c(GEO_ID,state,county,tract,NAME)) %>%
pivot_longer(
starts_with("P"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
dec_vars_2010 %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,"category1","category2"),
sep = "!!"
)
sum(smc_pop_race_2010$pop)
sum(smc_pop_race_2010$estimate)
sum(smc_pop_race_2010$estimate)
smc_pop_race_2020 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:081",
vars = "group(P1)"
) %>%
mutate(
block =
paste0(state,county,tract,block)
) %>%
select(!c(GEO_ID,state,county,tract,NAME) & !ends_with(c("NA"))) %>%
pivot_longer(
ends_with("N"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
dec_vars_2020 %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,"category1","category2"),
sep = "!!"
) %>%
filter(!is.na(age))
Sys.setenv(CENSUS_KEY="0f0e2bffc9d96d5405bcb932e25318a4edb32602")
smc_pop_2020 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:081",
vars = "P1_001N"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P1_001N
)
dec_vars_2020 <-
listCensusMetadata(
name = "2020/dec/pl",
type = "variables"
)
View(smc_pop_2020)
sum(smc_pop_2020$pop)
sum(smc_pop_2010$pop)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = F, message = F)
library(tidyverse)
library(plotly)
library(sf)
library(tigris)
library(leaflet)
library(censusapi)
Sys.setenv(CENSUS_KEY="0f0e2bffc9d96d5405bcb932e25318a4edb32602")
smc_pop_2020 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:081",
vars = "P1_001N"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P1_001N
)
dec_vars_2020 <-
listCensusMetadata(
name = "2020/dec/pl",
type = "variables"
)
smc_blocks_2020 <- blocks("CA", "San Mateo", year = 2020, progress_bar = F)
View(smc_pop_2020)
View(smc_blocks_2020)
mp_boundary <- places("CA", progress_bar = "F") %>%
filter(NAME == "Menlo Park")
mp_pop_2020 <- smc_pop_2020 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[mp_boundary, ] %>%
st_set_geometry(NULL) %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
mapview(mp_pop_2020, zcol = "pop")
Sys.setenv(CENSUS_KEY="0f0e2bffc9d96d5405bcb932e25318a4edb32602")
smc_pop_2010 <-
getCensus(
name = "dec/pl",
vintage = 2010,
region = "block:*",
regionin = "state:06+county:081",
vars = "P001001"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P001001
)
dec_vars_2010 <-
listCensusMetadata(
name = "2010/dec/pl",
type = "variables"
)
View(smc_pop_2010)
smc_pop_2010 <-
getCensus(
name = "dec/pl",
vintage = 2010,
region = "block:*",
regionin = "state:06+county:081",
vars = "P001001"
)
View(smc_pop_2010)
View(dec_vars_2010)
mp_pop_2010 <- smc_pop_2010 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[mp_boundary, ] %>%
st_set_geometry(NULL) %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
View(mp_pop_2010)
View(smc_pop_2010)
View(smc_pop_2010)
smc_pop_2010 <-
getCensus(
name = "dec/pl",
vintage = 2010,
region = "block:*",
regionin = "state:06+county:081",
vars = "P001001"
)
View(smc_pop_2010)
smc_pop_2010 <-
getCensus(
name = "dec/pl",
vintage = 2010,
region = "block:*",
regionin = "state:06+county:081",
vars = "P001001"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P001001
)
View(smc_pop_2010)
mp_pop_2010 <- smc_pop_2010 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[mp_boundary, ] %>%
st_set_geometry(NULL) %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
View(mp_pop_2010)
View(mp_pop_2010)
View(mp_pop_2020)
View(mp_pop_2010)
sum(mp_pop_2010)
sum(mp_pop_2010$pop)
sum(mp_pop_2020$pop)
smc_blocks_2020 <- blocks("CA", "San Mateo", year = 2020, progress_bar = F)
mp_boundary <- places("CA", progress_bar = "F") %>%
filter(NAME == "Menlo Park")
mp_blocks_2020 <- smc_pop_2020 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[mp_boundary, ] %>%
st_set_geometry(NULL) %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
mapview(mp_pop_2020, zcol = "pop")
mp_blocks_2020 <- smc_pop_2020 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[mp_boundary, ] %>%
st_set_geometry(NULL) %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
mp_blocks_2010 <- smc_pop_2010 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[mp_boundary, ] %>%
st_set_geometry(NULL) %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
mapview(mp_pop_2020, zcol = "pop")
mapview(mp_blocks_2010, zcol = "pop")
View(mp_blocks_2010)
View(mp_blocks_2010)
View(smc_blocks_2020)
View(smc_pop_2010)
mp_blocks_2010 <- smc_pop_2010 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[mp_boundary, ] %>%
st_set_geometry(NULL) %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
mapview(mp_blocks_2010, zcol = "pop")
mp_blocks_2010 <- smc_pop_2010 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20))
View(mp_blocks_2010)
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
data = mp_blocks_2010,
stroke = F,
fillOpacity = 0.5
) %>%
addPolygons(
data = mp_blocks_2020,
color = "red",
weight = 0.75,
fill = F
)
mp_blocks_2010 <- smc_pop_2010 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[mp_boundary, ] %>%
st_set_geometry(NULL) %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
data = mp_blocks_2010,
stroke = F,
fillOpacity = 0.5
) %>%
addPolygons(
data = mp_blocks_2020,
color = "red",
weight = 0.75,
fill = F
)
x
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
data = mp_blocks_2020,
stroke = F,
fillOpacity = 0.5
) %>%
addPolygons(
data = mp_blocks_2010,
color = "red",
weight = 0.75,
fill = F
)
View(smc_pop_2010)
smc_blocks_2020 <- blocks("CA", "San Mateo", year = 2020, progress_bar = F)
sc_boundary <- places("CA", progress_bar = "F") %>%
filter(NAME == "San Carlos")
sc_blocks_2020 <- smc_pop_2020 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[mp_boundary, ] %>%
st_set_geometry(NULL) %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
mapview(sc_blocks_2020, zcol = "pop")
smc_blocks_2020 <- blocks("CA", "San Mateo", year = 2020, progress_bar = F)
sc_boundary <- places("CA", progress_bar = "F") %>%
filter(NAME == "San Carlos")
sc_blocks_2020 <- smc_pop_2020 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[sc_boundary, ] %>%
st_set_geometry(NULL) %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
mapview(sc_blocks_2020, zcol = "pop")
